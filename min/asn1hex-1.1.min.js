var ASN1HEX=new function(){};ASN1HEX.getLblen=function(s,idx){if(s.substr(idx+2,1)!="8")return 1;var i=parseInt(s.substr(idx+3,1));if(i==0)return-1;if(0<i&&i<10)return i+1;return-2};ASN1HEX.getL=function(s,idx){var len=ASN1HEX.getLblen(s,idx);if(len<1)return"";return s.substr(idx+2,len*2)};ASN1HEX.getVblen=function(s,idx){var hLen,bi;hLen=ASN1HEX.getL(s,idx);if(hLen=="")return-1;if(hLen.substr(0,1)==="8"){bi=new BigInteger(hLen.substr(2),16)}else{bi=new BigInteger(hLen,16)}return bi.intValue()};ASN1HEX.getVidx=function(s,idx){var l_len=ASN1HEX.getLblen(s,idx);if(l_len<0)return l_len;return idx+(l_len+1)*2};ASN1HEX.getV=function(s,idx){var idx1=ASN1HEX.getVidx(s,idx);var blen=ASN1HEX.getVblen(s,idx);return s.substr(idx1,blen*2)};ASN1HEX.getTLV=function(s,idx){return s.substr(idx,2)+ASN1HEX.getL(s,idx)+ASN1HEX.getV(s,idx)};ASN1HEX.getNextSiblingIdx=function(s,idx){var idx1=ASN1HEX.getVidx(s,idx);var blen=ASN1HEX.getVblen(s,idx);return idx1+blen*2};ASN1HEX.getChildIdx=function(h,pos){var _ASN1HEX=ASN1HEX;var a=new Array;var p0=_ASN1HEX.getVidx(h,pos);if(h.substr(pos,2)=="03"){a.push(p0+2)}else{a.push(p0)}var blen=_ASN1HEX.getVblen(h,pos);var p=p0;var k=0;while(1){var pNext=_ASN1HEX.getNextSiblingIdx(h,p);if(pNext==null||pNext-p0>=blen*2)break;if(k>=200)break;a.push(pNext);p=pNext;k++}return a};ASN1HEX.getNthChildIdx=function(h,idx,nth){var a=ASN1HEX.getChildIdx(h,idx);return a[nth]};ASN1HEX.getIdxbyList=function(h,currentIndex,nthList,checkingTag){var _ASN1HEX=ASN1HEX;var firstNth,a;if(nthList.length==0){if(checkingTag!==undefined){if(h.substr(currentIndex,2)!==checkingTag){throw"checking tag doesn't match: "+h.substr(currentIndex,2)+"!="+checkingTag}}return currentIndex}firstNth=nthList.shift();a=_ASN1HEX.getChildIdx(h,currentIndex);return _ASN1HEX.getIdxbyList(h,a[firstNth],nthList,checkingTag)};ASN1HEX.getTLVbyList=function(h,currentIndex,nthList,checkingTag){var _ASN1HEX=ASN1HEX;var idx=_ASN1HEX.getIdxbyList(h,currentIndex,nthList);if(idx===undefined){throw"can't find nthList object"}if(checkingTag!==undefined){if(h.substr(idx,2)!=checkingTag){throw"checking tag doesn't match: "+h.substr(idx,2)+"!="+checkingTag}}return _ASN1HEX.getTLV(h,idx)};ASN1HEX.getVbyList=function(h,currentIndex,nthList,checkingTag,removeUnusedbits){var _ASN1HEX=ASN1HEX;var idx,v;idx=_ASN1HEX.getIdxbyList(h,currentIndex,nthList,checkingTag);if(idx===undefined){throw"can't find nthList object"}v=_ASN1HEX.getV(h,idx);if(removeUnusedbits===true)v=v.substr(2);return v};ASN1HEX.hextooidstr=function(hex){var zeroPadding=function(s,len){if(s.length>=len)return s;return new Array(len-s.length+1).join("0")+s};var a=[];var hex0=hex.substr(0,2);var i0=parseInt(hex0,16);a[0]=new String(Math.floor(i0/40));a[1]=new String(i0%40);var hex1=hex.substr(2);var b=[];for(var i=0;i<hex1.length/2;i++){b.push(parseInt(hex1.substr(i*2,2),16))}var c=[];var cbin="";for(var i=0;i<b.length;i++){if(b[i]&128){cbin=cbin+zeroPadding((b[i]&127).toString(2),7)}else{cbin=cbin+zeroPadding((b[i]&127).toString(2),7);c.push(new String(parseInt(cbin,2)));cbin=""}}var s=a.join(".");if(c.length>0)s=s+"."+c.join(".");return s};ASN1HEX.dump=function(hexOrObj,flags,idx,indent){var _ASN1HEX=ASN1HEX;var _getV=_ASN1HEX.getV;var _dump=_ASN1HEX.dump;var _getChildIdx=_ASN1HEX.getChildIdx;var hex=hexOrObj;if(hexOrObj instanceof KJUR.asn1.ASN1Object)hex=hexOrObj.getEncodedHex();var _skipLongHex=function(hex,limitNumOctet){if(hex.length<=limitNumOctet*2){return hex}else{var s=hex.substr(0,limitNumOctet)+"..(total "+hex.length/2+"bytes).."+hex.substr(hex.length-limitNumOctet,limitNumOctet);return s}};if(flags===undefined)flags={ommit_long_octet:32};if(idx===undefined)idx=0;if(indent===undefined)indent="";var skipLongHex=flags.ommit_long_octet;if(hex.substr(idx,2)=="01"){var v=_getV(hex,idx);if(v=="00"){return indent+"BOOLEAN FALSE\n"}else{return indent+"BOOLEAN TRUE\n"}}if(hex.substr(idx,2)=="02"){var v=_getV(hex,idx);return indent+"INTEGER "+_skipLongHex(v,skipLongHex)+"\n"}if(hex.substr(idx,2)=="03"){var v=_getV(hex,idx);return indent+"BITSTRING "+_skipLongHex(v,skipLongHex)+"\n"}if(hex.substr(idx,2)=="04"){var v=_getV(hex,idx);if(_ASN1HEX.isASN1HEX(v)){var s=indent+"OCTETSTRING, encapsulates\n";s=s+_dump(v,flags,0,indent+"  ");return s}else{return indent+"OCTETSTRING "+_skipLongHex(v,skipLongHex)+"\n"}}if(hex.substr(idx,2)=="05"){return indent+"NULL\n"}if(hex.substr(idx,2)=="06"){var hV=_getV(hex,idx);var oidDot=KJUR.asn1.ASN1Util.oidHexToInt(hV);var oidName=KJUR.asn1.x509.OID.oid2name(oidDot);var oidSpc=oidDot.replace(/\./g," ");if(oidName!=""){return indent+"ObjectIdentifier "+oidName+" ("+oidSpc+")\n"}else{return indent+"ObjectIdentifier ("+oidSpc+")\n"}}if(hex.substr(idx,2)=="0c"){return indent+"UTF8String '"+hextoutf8(_getV(hex,idx))+"'\n"}if(hex.substr(idx,2)=="13"){return indent+"PrintableString '"+hextoutf8(_getV(hex,idx))+"'\n"}if(hex.substr(idx,2)=="14"){return indent+"TeletexString '"+hextoutf8(_getV(hex,idx))+"'\n"}if(hex.substr(idx,2)=="16"){return indent+"IA5String '"+hextoutf8(_getV(hex,idx))+"'\n"}if(hex.substr(idx,2)=="17"){return indent+"UTCTime "+hextoutf8(_getV(hex,idx))+"\n"}if(hex.substr(idx,2)=="18"){return indent+"GeneralizedTime "+hextoutf8(_getV(hex,idx))+"\n"}if(hex.substr(idx,2)=="30"){if(hex.substr(idx,4)=="3000"){return indent+"SEQUENCE {}\n"}var s=indent+"SEQUENCE\n";var aIdx=_getChildIdx(hex,idx);var flagsTemp=flags;if((aIdx.length==2||aIdx.length==3)&&hex.substr(aIdx[0],2)=="06"&&hex.substr(aIdx[aIdx.length-1],2)=="04"){var oidName=_ASN1HEX.oidname(_getV(hex,aIdx[0]));var flagsClone=JSON.parse(JSON.stringify(flags));flagsClone.x509ExtName=oidName;flagsTemp=flagsClone}for(var i=0;i<aIdx.length;i++){s=s+_dump(hex,flagsTemp,aIdx[i],indent+"  ")}return s}if(hex.substr(idx,2)=="31"){var s=indent+"SET\n";var aIdx=_getChildIdx(hex,idx);for(var i=0;i<aIdx.length;i++){s=s+_dump(hex,flags,aIdx[i],indent+"  ")}return s}var tag=parseInt(hex.substr(idx,2),16);if((tag&128)!=0){var tagNumber=tag&31;if((tag&32)!=0){var s=indent+"["+tagNumber+"]\n";var aIdx=_getChildIdx(hex,idx);for(var i=0;i<aIdx.length;i++){s=s+_dump(hex,flags,aIdx[i],indent+"  ")}return s}else{var v=_getV(hex,idx);if(v.substr(0,8)=="68747470"){v=hextoutf8(v)}if(flags.x509ExtName==="subjectAltName"&&tagNumber==2){v=hextoutf8(v)}var s=indent+"["+tagNumber+"] "+v+"\n";return s}}return indent+"UNKNOWN("+hex.substr(idx,2)+") "+_getV(hex,idx)+"\n"};ASN1HEX.isASN1HEX=function(hex){var _ASN1HEX=ASN1HEX;if(hex.length%2==1)return false;var intL=_ASN1HEX.getVblen(hex,0);var tV=hex.substr(0,2);var lV=_ASN1HEX.getL(hex,0);var hVLength=hex.length-tV.length-lV.length;if(hVLength==intL*2)return true;return false};ASN1HEX.oidname=function(oidDotOrHex){var _KJUR_asn1=KJUR.asn1;if(KJUR.lang.String.isHex(oidDotOrHex))oidDotOrHex=_KJUR_asn1.ASN1Util.oidHexToInt(oidDotOrHex);var name=_KJUR_asn1.x509.OID.oid2name(oidDotOrHex);if(name==="")name=oidDotOrHex;return name};