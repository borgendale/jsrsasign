if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.DSA=function(){this.p=null;this.q=null;this.g=null;this.y=null;this.x=null;this.type="DSA";this.isPrivate=false;this.isPublic=false;this.setPrivate=function(p,q,g,y,x){this.isPrivate=true;this.p=p;this.q=q;this.g=g;this.y=y;this.x=x};this.setPrivateHex=function(hP,hQ,hG,hY,hX){var biP,biQ,biG,biY,biX;biP=new BigInteger(hP,16);biQ=new BigInteger(hQ,16);biG=new BigInteger(hG,16);if(typeof hY==="string"&&hY.length>1){biY=new BigInteger(hY,16)}else{biY=null}biX=new BigInteger(hX,16);this.setPrivate(biP,biQ,biG,biY,biX)};this.setPublic=function(p,q,g,y){this.isPublic=true;this.p=p;this.q=q;this.g=g;this.y=y;this.x=null};this.setPublicHex=function(hP,hQ,hG,hY){var biP,biQ,biG,biY;biP=new BigInteger(hP,16);biQ=new BigInteger(hQ,16);biG=new BigInteger(hG,16);biY=new BigInteger(hY,16);this.setPublic(biP,biQ,biG,biY)};this.signWithMessageHash=function(sHashHex){var p=this.p;var q=this.q;var g=this.g;var y=this.y;var x=this.x;var k=KJUR.crypto.Util.getRandomBigIntegerMinToMax(BigInteger.ONE.add(BigInteger.ONE),q.subtract(BigInteger.ONE));var hZ=sHashHex.substr(0,q.bitLength()/4);var z=new BigInteger(hZ,16);var r=g.modPow(k,p).mod(q);var s=k.modInverse(q).multiply(z.add(x.multiply(r))).mod(q);var result=KJUR.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:r}},{int:{bigint:s}}]});return result};this.verifyWithMessageHash=function(sHashHex,hSigVal){var p=this.p;var q=this.q;var g=this.g;var y=this.y;var rs=this.parseASN1Signature(hSigVal);var r=rs[0];var s=rs[1];var hZ=sHashHex.substr(0,q.bitLength()/4);var z=new BigInteger(hZ,16);if(BigInteger.ZERO.compareTo(r)>0||r.compareTo(q)>0)throw"invalid DSA signature";if(BigInteger.ZERO.compareTo(s)>=0||s.compareTo(q)>0)throw"invalid DSA signature";var w=s.modInverse(q);var u1=z.multiply(w).mod(q);var u2=r.multiply(w).mod(q);var v=g.modPow(u1,p).multiply(y.modPow(u2,p)).mod(p).mod(q);return v.compareTo(r)==0};this.parseASN1Signature=function(hSigVal){try{var r=new BigInteger(ASN1HEX.getVbyList(hSigVal,0,[0],"02"),16);var s=new BigInteger(ASN1HEX.getVbyList(hSigVal,0,[1],"02"),16);return[r,s]}catch(ex){throw"malformed ASN.1 DSA signature"}};this.readPKCS5PrvKeyHex=function(h){var hP,hQ,hG,hY,hX;var _ASN1HEX=ASN1HEX;var _getVbyList=_ASN1HEX.getVbyList;if(_ASN1HEX.isASN1HEX(h)===false)throw"not ASN.1 hex string";try{hP=_getVbyList(h,0,[1],"02");hQ=_getVbyList(h,0,[2],"02");hG=_getVbyList(h,0,[3],"02");hY=_getVbyList(h,0,[4],"02");hX=_getVbyList(h,0,[5],"02")}catch(ex){console.log("EXCEPTION:"+ex);throw"malformed PKCS#1/5 plain DSA private key"}this.setPrivateHex(hP,hQ,hG,hY,hX)};this.readPKCS8PrvKeyHex=function(h){var hP,hQ,hG,hX;var _ASN1HEX=ASN1HEX;var _getVbyList=_ASN1HEX.getVbyList;if(_ASN1HEX.isASN1HEX(h)===false)throw"not ASN.1 hex string";try{hP=_getVbyList(h,0,[1,1,0],"02");hQ=_getVbyList(h,0,[1,1,1],"02");hG=_getVbyList(h,0,[1,1,2],"02");hX=_getVbyList(h,0,[2,0],"02")}catch(ex){console.log("EXCEPTION:"+ex);throw"malformed PKCS#8 plain DSA private key"}this.setPrivateHex(hP,hQ,hG,null,hX)};this.readPKCS8PubKeyHex=function(h){var hP,hQ,hG,hY;var _ASN1HEX=ASN1HEX;var _getVbyList=_ASN1HEX.getVbyList;if(_ASN1HEX.isASN1HEX(h)===false)throw"not ASN.1 hex string";try{hP=_getVbyList(h,0,[0,1,0],"02");hQ=_getVbyList(h,0,[0,1,1],"02");hG=_getVbyList(h,0,[0,1,2],"02");hY=_getVbyList(h,0,[1,0],"02")}catch(ex){console.log("EXCEPTION:"+ex);throw"malformed PKCS#8 DSA public key"}this.setPublicHex(hP,hQ,hG,hY)};this.readCertPubKeyHex=function(h,nthPKI){if(nthPKI!==5)nthPKI=6;var hP,hQ,hG,hY;var _ASN1HEX=ASN1HEX;var _getVbyList=_ASN1HEX.getVbyList;if(_ASN1HEX.isASN1HEX(h)===false)throw"not ASN.1 hex string";try{hP=_getVbyList(h,0,[0,nthPKI,0,1,0],"02");hQ=_getVbyList(h,0,[0,nthPKI,0,1,1],"02");hG=_getVbyList(h,0,[0,nthPKI,0,1,2],"02");hY=_getVbyList(h,0,[0,nthPKI,1,0],"02")}catch(ex){console.log("EXCEPTION:"+ex);throw"malformed X.509 certificate DSA public key"}this.setPublicHex(hP,hQ,hG,hY)}};