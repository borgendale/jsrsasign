if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.x509=="undefined"||!KJUR.asn1.x509)KJUR.asn1.x509={};KJUR.asn1.x509.Certificate=function(params){KJUR.asn1.x509.Certificate.superclass.constructor.call(this);var asn1TBSCert=null,asn1SignatureAlg=null,asn1Sig=null,hexSig=null,prvKey=null,_KJUR=KJUR,_KJUR_crypto=_KJUR.crypto,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_DERBitString=_KJUR_asn1.DERBitString;this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg;var sig=new KJUR.crypto.Signature({alg:this.asn1SignatureAlg.nameAlg});sig.init(this.prvKey);sig.updateHex(this.asn1TBSCert.getEncodedHex());this.hexSig=sig.sign();this.asn1Sig=new _DERBitString({hex:"00"+this.hexSig});var seq=new _DERSequence({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.setSignatureHex=function(sigHex){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg;this.hexSig=sigHex;this.asn1Sig=new _DERBitString({hex:"00"+this.hexSig});var seq=new _DERSequence({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.getEncodedHex=function(){if(this.isModified==false&&this.hTLV!=null)return this.hTLV;throw"not signed yet"};this.getPEMString=function(){var pemBody=hextob64nl(this.getEncodedHex());return"-----BEGIN CERTIFICATE-----\r\n"+pemBody+"\r\n-----END CERTIFICATE-----\r\n"};if(params!==undefined){if(params.tbscertobj!==undefined){this.asn1TBSCert=params.tbscertobj}if(params.prvkeyobj!==undefined){this.prvKey=params.prvkeyobj}}};YAHOO.lang.extend(KJUR.asn1.x509.Certificate,KJUR.asn1.ASN1Object);KJUR.asn1.x509.TBSCertificate=function(params){KJUR.asn1.x509.TBSCertificate.superclass.constructor.call(this);var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_DERInteger=_KJUR_asn1.DERInteger,_DERTaggedObject=_KJUR_asn1.DERTaggedObject,_KJUR_asn1_x509=_KJUR_asn1.x509,_Time=_KJUR_asn1_x509.Time,_X500Name=_KJUR_asn1_x509.X500Name,_SubjectPublicKeyInfo=_KJUR_asn1_x509.SubjectPublicKeyInfo;this._initialize=function(){this.asn1Array=new Array;this.asn1Version=new _DERTaggedObject({obj:new _DERInteger({int:2})});this.asn1SerialNumber=null;this.asn1SignatureAlg=null;this.asn1Issuer=null;this.asn1NotBefore=null;this.asn1NotAfter=null;this.asn1Subject=null;this.asn1SubjPKey=null;this.extensionsArray=new Array};this.setSerialNumberByParam=function(intParam){this.asn1SerialNumber=new _DERInteger(intParam)};this.setSignatureAlgByParam=function(algIdParam){this.asn1SignatureAlg=new _KJUR_asn1_x509.AlgorithmIdentifier(algIdParam)};this.setIssuerByParam=function(x500NameParam){this.asn1Issuer=new _X500Name(x500NameParam)};this.setNotBeforeByParam=function(timeParam){this.asn1NotBefore=new _Time(timeParam)};this.setNotAfterByParam=function(timeParam){this.asn1NotAfter=new _Time(timeParam)};this.setSubjectByParam=function(x500NameParam){this.asn1Subject=new _X500Name(x500NameParam)};this.setSubjectPublicKey=function(param){this.asn1SubjPKey=new _SubjectPublicKeyInfo(param)};this.setSubjectPublicKeyByGetKey=function(keyParam){var keyObj=KEYUTIL.getKey(keyParam);this.asn1SubjPKey=new _SubjectPublicKeyInfo(keyObj)};this.appendExtension=function(extObj){this.extensionsArray.push(extObj)};this.appendExtensionByName=function(name,extParams){KJUR.asn1.x509.Extension.appendByNameToArray(name,extParams,this.extensionsArray)};this.getEncodedHex=function(){if(this.asn1NotBefore==null||this.asn1NotAfter==null)throw"notBefore and/or notAfter not set";var asn1Validity=new _DERSequence({array:[this.asn1NotBefore,this.asn1NotAfter]});this.asn1Array=new Array;this.asn1Array.push(this.asn1Version);this.asn1Array.push(this.asn1SerialNumber);this.asn1Array.push(this.asn1SignatureAlg);this.asn1Array.push(this.asn1Issuer);this.asn1Array.push(asn1Validity);this.asn1Array.push(this.asn1Subject);this.asn1Array.push(this.asn1SubjPKey);if(this.extensionsArray.length>0){var extSeq=new _DERSequence({array:this.extensionsArray});var extTagObj=new _DERTaggedObject({explicit:true,tag:"a3",obj:extSeq});this.asn1Array.push(extTagObj)}var o=new _DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();this.isModified=false;return this.hTLV};this._initialize()};YAHOO.lang.extend(KJUR.asn1.x509.TBSCertificate,KJUR.asn1.ASN1Object);KJUR.asn1.x509.Extension=function(params){KJUR.asn1.x509.Extension.superclass.constructor.call(this);var asn1ExtnValue=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERObjectIdentifier=_KJUR_asn1.DERObjectIdentifier,_DEROctetString=_KJUR_asn1.DEROctetString,_DERBitString=_KJUR_asn1.DERBitString,_DERBoolean=_KJUR_asn1.DERBoolean,_DERSequence=_KJUR_asn1.DERSequence;this.getEncodedHex=function(){var asn1Oid=new _DERObjectIdentifier({oid:this.oid});var asn1EncapExtnValue=new _DEROctetString({hex:this.getExtnValueHex()});var asn1Array=new Array;asn1Array.push(asn1Oid);if(this.critical)asn1Array.push(new _DERBoolean);asn1Array.push(asn1EncapExtnValue);var asn1Seq=new _DERSequence({array:asn1Array});return asn1Seq.getEncodedHex()};this.critical=false;if(params!==undefined){if(params.critical!==undefined){this.critical=params.critical}}};YAHOO.lang.extend(KJUR.asn1.x509.Extension,KJUR.asn1.ASN1Object);KJUR.asn1.x509.Extension.appendByNameToArray=function(name,extParams,a){var _lowname=name.toLowerCase(),_KJUR_asn1_x509=KJUR.asn1.x509;if(_lowname=="basicconstraints"){var extObj=new _KJUR_asn1_x509.BasicConstraints(extParams);a.push(extObj)}else if(_lowname=="keyusage"){var extObj=new _KJUR_asn1_x509.KeyUsage(extParams);a.push(extObj)}else if(_lowname=="crldistributionpoints"){var extObj=new _KJUR_asn1_x509.CRLDistributionPoints(extParams);a.push(extObj)}else if(_lowname=="extkeyusage"){var extObj=new _KJUR_asn1_x509.ExtKeyUsage(extParams);a.push(extObj)}else if(_lowname=="authoritykeyidentifier"){var extObj=new _KJUR_asn1_x509.AuthorityKeyIdentifier(extParams);a.push(extObj)}else if(_lowname=="authorityinfoaccess"){var extObj=new _KJUR_asn1_x509.AuthorityInfoAccess(extParams);a.push(extObj)}else if(_lowname=="subjectaltname"){var extObj=new _KJUR_asn1_x509.SubjectAltName(extParams);a.push(extObj)}else if(_lowname=="issueraltname"){var extObj=new _KJUR_asn1_x509.IssuerAltName(extParams);a.push(extObj)}else{throw"unsupported extension name: "+name}};KJUR.asn1.x509.KeyUsage=function(params){KJUR.asn1.x509.KeyUsage.superclass.constructor.call(this,params);var _KEYUSAGE_NAME=X509.KEYUSAGE_NAME;this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.15";if(params!==undefined){if(params.bin!==undefined){this.asn1ExtnValue=new KJUR.asn1.DERBitString(params)}if(params.names!==undefined&&params.names.length!==undefined){var names=params.names;var s="000000000";for(var i=0;i<names.length;i++){for(var j=0;j<_KEYUSAGE_NAME.length;j++){if(names[i]===_KEYUSAGE_NAME[j]){s=s.substring(0,j)+"1"+s.substring(j+1,s.length)}}}this.asn1ExtnValue=new KJUR.asn1.DERBitString({bin:s})}}};YAHOO.lang.extend(KJUR.asn1.x509.KeyUsage,KJUR.asn1.x509.Extension);KJUR.asn1.x509.BasicConstraints=function(params){KJUR.asn1.x509.BasicConstraints.superclass.constructor.call(this,params);var cA=false;var pathLen=-1;this.getExtnValueHex=function(){var asn1Array=new Array;if(this.cA)asn1Array.push(new KJUR.asn1.DERBoolean);if(this.pathLen>-1)asn1Array.push(new KJUR.asn1.DERInteger({int:this.pathLen}));var asn1Seq=new KJUR.asn1.DERSequence({array:asn1Array});this.asn1ExtnValue=asn1Seq;return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.19";this.cA=false;this.pathLen=-1;if(params!==undefined){if(params.cA!==undefined){this.cA=params.cA}if(params.pathLen!==undefined){this.pathLen=params.pathLen}}};YAHOO.lang.extend(KJUR.asn1.x509.BasicConstraints,KJUR.asn1.x509.Extension);KJUR.asn1.x509.CRLDistributionPoints=function(params){KJUR.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,params);var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_KJUR_asn1_x509=_KJUR_asn1.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.setByDPArray=function(dpArray){this.asn1ExtnValue=new _KJUR_asn1.DERSequence({array:dpArray})};this.setByOneURI=function(uri){var gn1=new _KJUR_asn1_x509.GeneralNames([{uri:uri}]);var dpn1=new _KJUR_asn1_x509.DistributionPointName(gn1);var dp1=new _KJUR_asn1_x509.DistributionPoint({dpobj:dpn1});this.setByDPArray([dp1])};this.oid="2.5.29.31";if(params!==undefined){if(params.array!==undefined){this.setByDPArray(params.array)}else if(params.uri!==undefined){this.setByOneURI(params.uri)}}};YAHOO.lang.extend(KJUR.asn1.x509.CRLDistributionPoints,KJUR.asn1.x509.Extension);KJUR.asn1.x509.ExtKeyUsage=function(params){KJUR.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,params);var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.setPurposeArray=function(purposeArray){this.asn1ExtnValue=new _KJUR_asn1.DERSequence;for(var i=0;i<purposeArray.length;i++){var o=new _KJUR_asn1.DERObjectIdentifier(purposeArray[i]);this.asn1ExtnValue.appendASN1Object(o)}};this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.37";if(params!==undefined){if(params.array!==undefined){this.setPurposeArray(params.array)}}};YAHOO.lang.extend(KJUR.asn1.x509.ExtKeyUsage,KJUR.asn1.x509.Extension);KJUR.asn1.x509.AuthorityKeyIdentifier=function(params){KJUR.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,params);var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERTaggedObject=_KJUR_asn1.DERTaggedObject;this.asn1KID=null;this.asn1CertIssuer=null;this.asn1CertSN=null;this.getExtnValueHex=function(){var a=new Array;if(this.asn1KID)a.push(new _DERTaggedObject({explicit:false,tag:"80",obj:this.asn1KID}));if(this.asn1CertIssuer)a.push(new _DERTaggedObject({explicit:false,tag:"a1",obj:this.asn1CertIssuer}));if(this.asn1CertSN)a.push(new _DERTaggedObject({explicit:false,tag:"82",obj:this.asn1CertSN}));var asn1Seq=new _KJUR_asn1.DERSequence({array:a});this.asn1ExtnValue=asn1Seq;return this.asn1ExtnValue.getEncodedHex()};this.setKIDByParam=function(param){this.asn1KID=new KJUR.asn1.DEROctetString(param)};this.setCertIssuerByParam=function(param){this.asn1CertIssuer=new KJUR.asn1.x509.X500Name(param)};this.setCertSNByParam=function(param){this.asn1CertSN=new KJUR.asn1.DERInteger(param)};this.oid="2.5.29.35";if(params!==undefined){if(params.kid!==undefined){this.setKIDByParam(params.kid)}if(params.issuer!==undefined){this.setCertIssuerByParam(params.issuer)}if(params.sn!==undefined){this.setCertSNByParam(params.sn)}}};YAHOO.lang.extend(KJUR.asn1.x509.AuthorityKeyIdentifier,KJUR.asn1.x509.Extension);KJUR.asn1.x509.AuthorityInfoAccess=function(params){KJUR.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,params);this.setAccessDescriptionArray=function(accessDescriptionArray){var array=new Array,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence;for(var i=0;i<accessDescriptionArray.length;i++){var o=new _KJUR_asn1.DERObjectIdentifier(accessDescriptionArray[i].accessMethod);var gn=new _KJUR_asn1.x509.GeneralName(accessDescriptionArray[i].accessLocation);var accessDescription=new _DERSequence({array:[o,gn]});array.push(accessDescription)}this.asn1ExtnValue=new _DERSequence({array:array})};this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="1.3.6.1.5.5.7.1.1";if(params!==undefined){if(params.array!==undefined){this.setAccessDescriptionArray(params.array)}}};YAHOO.lang.extend(KJUR.asn1.x509.AuthorityInfoAccess,KJUR.asn1.x509.Extension);KJUR.asn1.x509.SubjectAltName=function(params){KJUR.asn1.x509.SubjectAltName.superclass.constructor.call(this,params);this.setNameArray=function(paramsArray){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(paramsArray)};this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.17";if(params!==undefined){if(params.array!==undefined){this.setNameArray(params.array)}}};YAHOO.lang.extend(KJUR.asn1.x509.SubjectAltName,KJUR.asn1.x509.Extension);KJUR.asn1.x509.IssuerAltName=function(params){KJUR.asn1.x509.IssuerAltName.superclass.constructor.call(this,params);this.setNameArray=function(paramsArray){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(paramsArray)};this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.18";if(params!==undefined){if(params.array!==undefined){this.setNameArray(params.array)}}};YAHOO.lang.extend(KJUR.asn1.x509.IssuerAltName,KJUR.asn1.x509.Extension);KJUR.asn1.x509.CRL=function(params){KJUR.asn1.x509.CRL.superclass.constructor.call(this);var asn1TBSCertList=null,asn1SignatureAlg=null,asn1Sig=null,hexSig=null,prvKey=null;this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCertList.asn1SignatureAlg;sig=new KJUR.crypto.Signature({alg:"SHA1withRSA",prov:"cryptojs/jsrsa"});sig.init(this.prvKey);sig.updateHex(this.asn1TBSCertList.getEncodedHex());this.hexSig=sig.sign();this.asn1Sig=new KJUR.asn1.DERBitString({hex:"00"+this.hexSig});var seq=new KJUR.asn1.DERSequence({array:[this.asn1TBSCertList,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.getEncodedHex=function(){if(this.isModified==false&&this.hTLV!=null)return this.hTLV;throw"not signed yet"};this.getPEMString=function(){var pemBody=hextob64nl(this.getEncodedHex());return"-----BEGIN X509 CRL-----\r\n"+pemBody+"\r\n-----END X509 CRL-----\r\n"};if(params!==undefined){if(params.tbsobj!==undefined){this.asn1TBSCertList=params.tbsobj}if(params.prvkeyobj!==undefined){this.prvKey=params.prvkeyobj}}};YAHOO.lang.extend(KJUR.asn1.x509.CRL,KJUR.asn1.ASN1Object);KJUR.asn1.x509.TBSCertList=function(params){KJUR.asn1.x509.TBSCertList.superclass.constructor.call(this);var aRevokedCert=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_x509=_KJUR_asn1.x509,_Time=_KJUR_asn1_x509.Time;this.setSignatureAlgByParam=function(algIdParam){this.asn1SignatureAlg=new _KJUR_asn1_x509.AlgorithmIdentifier(algIdParam)};this.setIssuerByParam=function(x500NameParam){this.asn1Issuer=new _KJUR_asn1_x509.X500Name(x500NameParam)};this.setThisUpdateByParam=function(timeParam){this.asn1ThisUpdate=new _Time(timeParam)};this.setNextUpdateByParam=function(timeParam){this.asn1NextUpdate=new _Time(timeParam)};this.addRevokedCert=function(snParam,timeParam){var param={};if(snParam!=undefined&&snParam!=null)param["sn"]=snParam;if(timeParam!=undefined&&timeParam!=null)param["time"]=timeParam;var o=new _KJUR_asn1_x509.CRLEntry(param);this.aRevokedCert.push(o)};this.getEncodedHex=function(){this.asn1Array=new Array;if(this.asn1Version!=null)this.asn1Array.push(this.asn1Version);this.asn1Array.push(this.asn1SignatureAlg);this.asn1Array.push(this.asn1Issuer);this.asn1Array.push(this.asn1ThisUpdate);if(this.asn1NextUpdate!=null)this.asn1Array.push(this.asn1NextUpdate);if(this.aRevokedCert.length>0){var seq=new _DERSequence({array:this.aRevokedCert});this.asn1Array.push(seq)}var o=new _DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();this.isModified=false;return this.hTLV};this._initialize=function(){this.asn1Version=null;this.asn1SignatureAlg=null;this.asn1Issuer=null;this.asn1ThisUpdate=null;this.asn1NextUpdate=null;this.aRevokedCert=new Array};this._initialize()};YAHOO.lang.extend(KJUR.asn1.x509.TBSCertList,KJUR.asn1.ASN1Object);KJUR.asn1.x509.CRLEntry=function(params){KJUR.asn1.x509.CRLEntry.superclass.constructor.call(this);var sn=null,time=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.setCertSerial=function(intParam){this.sn=new _KJUR_asn1.DERInteger(intParam)};this.setRevocationDate=function(timeParam){this.time=new _KJUR_asn1.x509.Time(timeParam)};this.getEncodedHex=function(){var o=new _KJUR_asn1.DERSequence({array:[this.sn,this.time]});this.TLV=o.getEncodedHex();return this.TLV};if(params!==undefined){if(params.time!==undefined){this.setRevocationDate(params.time)}if(params.sn!==undefined){this.setCertSerial(params.sn)}}};YAHOO.lang.extend(KJUR.asn1.x509.CRLEntry,KJUR.asn1.ASN1Object);KJUR.asn1.x509.X500Name=function(params){KJUR.asn1.x509.X500Name.superclass.constructor.call(this);this.asn1Array=new Array;var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_KJUR_asn1_x509=_KJUR_asn1.x509,_pemtohex=pemtohex;this.setByString=function(dnStr){var a=dnStr.split("/");a.shift();var a1=[];for(var i=0;i<a.length;i++){if(a[i].match(/^[^=]+=.+$/)){a1.push(a[i])}else{var lastidx=a1.length-1;a1[lastidx]=a1[lastidx]+"/"+a[i]}}for(var i=0;i<a1.length;i++){this.asn1Array.push(new _KJUR_asn1_x509.RDN({str:a1[i]}))}};this.setByLdapString=function(dnStr){var oneline=_KJUR_asn1_x509.X500Name.ldapToOneline(dnStr);this.setByString(oneline)};this.setByObject=function(dnObj){for(var x in dnObj){if(dnObj.hasOwnProperty(x)){var newRDN=new KJUR.asn1.x509.RDN({str:x+"="+dnObj[x]});this.asn1Array?this.asn1Array.push(newRDN):this.asn1Array=[newRDN]}}};this.getEncodedHex=function(){if(typeof this.hTLV=="string")return this.hTLV;var o=new _KJUR_asn1.DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();return this.hTLV};if(params!==undefined){if(params.str!==undefined){this.setByString(params.str)}else if(params.ldapstr!==undefined){this.setByLdapString(params.ldapstr)}else if(typeof params==="object"){this.setByObject(params)}if(params.certissuer!==undefined){var x=new X509;x.hex=_pemtohex(params.certissuer);this.hTLV=x.getIssuerHex()}if(params.certsubject!==undefined){var x=new X509;x.hex=_pemtohex(params.certsubject);this.hTLV=x.getSubjectHex()}}};YAHOO.lang.extend(KJUR.asn1.x509.X500Name,KJUR.asn1.ASN1Object);KJUR.asn1.x509.X500Name.onelineToLDAP=function(s){if(s.substr(0,1)!=="/")throw"malformed input";var result="";s=s.substr(1);var a=s.split("/");a.reverse();a=a.map(function(s){return s.replace(/,/,"\\,")});return a.join(",")};KJUR.asn1.x509.X500Name.ldapToOneline=function(s){var a=s.split(",");var isBSbefore=false;var a2=[];for(var i=0;a.length>0;i++){var item=a.shift();if(isBSbefore===true){var a2last=a2.pop();var newitem=(a2last+","+item).replace(/\\,/g,",");a2.push(newitem);isBSbefore=false}else{a2.push(item)}if(item.substr(-1,1)==="\\")isBSbefore=true}a2=a2.map(function(s){return s.replace("/","\\/")});a2.reverse();return"/"+a2.join("/")};KJUR.asn1.x509.RDN=function(params){KJUR.asn1.x509.RDN.superclass.constructor.call(this);this.asn1Array=new Array;this.addByString=function(s){this.asn1Array.push(new KJUR.asn1.x509.AttributeTypeAndValue({str:s}))};this.addByMultiValuedString=function(s){var a=KJUR.asn1.x509.RDN.parseString(s);for(var i=0;i<a.length;i++){this.addByString(a[i])}};this.getEncodedHex=function(){var o=new KJUR.asn1.DERSet({array:this.asn1Array});this.TLV=o.getEncodedHex();return this.TLV};if(params!==undefined){if(params.str!==undefined){this.addByMultiValuedString(params.str)}}};YAHOO.lang.extend(KJUR.asn1.x509.RDN,KJUR.asn1.ASN1Object);KJUR.asn1.x509.RDN.parseString=function(s){var a=s.split(/\+/);var isBSbefore=false;var a2=[];for(var i=0;a.length>0;i++){var item=a.shift();if(isBSbefore===true){var a2last=a2.pop();var newitem=(a2last+"+"+item).replace(/\\\+/g,"+");a2.push(newitem);isBSbefore=false}else{a2.push(item)}if(item.substr(-1,1)==="\\")isBSbefore=true}var beginQuote=false;var a3=[];for(var i=0;a2.length>0;i++){var item=a2.shift();if(beginQuote===true){var a3last=a3.pop();if(item.match(/"$/)){var newitem=(a3last+"+"+item).replace(/^([^=]+)="(.*)"$/,"$1=$2");a3.push(newitem);beginQuote=false}else{a3.push(a3last+"+"+item)}}else{a3.push(item)}if(item.match(/^[^=]+="/)){beginQuote=true}}return a3};KJUR.asn1.x509.AttributeTypeAndValue=function(params){KJUR.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this);var typeObj=null,valueObj=null,defaultDSType="utf8",_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.setByString=function(attrTypeAndValueStr){var matchResult=attrTypeAndValueStr.match(/^([^=]+)=(.+)$/);if(matchResult){this.setByAttrTypeAndValueStr(matchResult[1],matchResult[2])}else{throw"malformed attrTypeAndValueStr: "+attrTypeAndValueStr}};this.setByAttrTypeAndValueStr=function(shortAttrType,valueStr){this.typeObj=KJUR.asn1.x509.OID.atype2obj(shortAttrType);var dsType=defaultDSType;if(shortAttrType=="C")dsType="prn";this.valueObj=this.getValueObj(dsType,valueStr)};this.getValueObj=function(dsType,valueStr){if(dsType=="utf8")return new _KJUR_asn1.DERUTF8String({str:valueStr});if(dsType=="prn")return new _KJUR_asn1.DERPrintableString({str:valueStr});if(dsType=="tel")return new _KJUR_asn1.DERTeletexString({str:valueStr});if(dsType=="ia5")return new _KJUR_asn1.DERIA5String({str:valueStr});throw"unsupported directory string type: type="+dsType+" value="+valueStr};this.getEncodedHex=function(){var o=new _KJUR_asn1.DERSequence({array:[this.typeObj,this.valueObj]});this.TLV=o.getEncodedHex();return this.TLV};if(params!==undefined){if(params.str!==undefined){this.setByString(params.str)}}};YAHOO.lang.extend(KJUR.asn1.x509.AttributeTypeAndValue,KJUR.asn1.ASN1Object);KJUR.asn1.x509.SubjectPublicKeyInfo=function(params){KJUR.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var asn1AlgId=null,asn1SubjPKey=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERInteger=_KJUR_asn1.DERInteger,_DERBitString=_KJUR_asn1.DERBitString,_DERObjectIdentifier=_KJUR_asn1.DERObjectIdentifier,_DERSequence=_KJUR_asn1.DERSequence,_newObject=_KJUR_asn1.ASN1Util.newObject,_KJUR_asn1_x509=_KJUR_asn1.x509,_AlgorithmIdentifier=_KJUR_asn1_x509.AlgorithmIdentifier,_KJUR_crypto=_KJUR.crypto,_KJUR_crypto_ECDSA=_KJUR_crypto.ECDSA,_KJUR_crypto_DSA=_KJUR_crypto.DSA;this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var o=new _DERSequence({array:[this.asn1AlgId,this.asn1SubjPKey]});return o};this.getEncodedHex=function(){var o=this.getASN1Object();this.hTLV=o.getEncodedHex();return this.hTLV};this.setPubKey=function(key){try{if(key instanceof RSAKey){var asn1RsaPub=_newObject({seq:[{int:{bigint:key.n}},{int:{int:key.e}}]});var rsaKeyHex=asn1RsaPub.getEncodedHex();this.asn1AlgId=new _AlgorithmIdentifier({name:"rsaEncryption"});this.asn1SubjPKey=new _DERBitString({hex:"00"+rsaKeyHex})}}catch(ex){}try{if(key instanceof KJUR.crypto.ECDSA){var asn1Params=new _DERObjectIdentifier({name:key.curveName});this.asn1AlgId=new _AlgorithmIdentifier({name:"ecPublicKey",asn1params:asn1Params});this.asn1SubjPKey=new _DERBitString({hex:"00"+key.pubKeyHex})}}catch(ex){}try{if(key instanceof KJUR.crypto.DSA){var asn1Params=new _newObject({seq:[{int:{bigint:key.p}},{int:{bigint:key.q}},{int:{bigint:key.g}}]});this.asn1AlgId=new _AlgorithmIdentifier({name:"dsa",asn1params:asn1Params});var pubInt=new _DERInteger({bigint:key.y});this.asn1SubjPKey=new _DERBitString({hex:"00"+pubInt.getEncodedHex()})}}catch(ex){}};if(params!==undefined){this.setPubKey(params)}};YAHOO.lang.extend(KJUR.asn1.x509.SubjectPublicKeyInfo,KJUR.asn1.ASN1Object);KJUR.asn1.x509.Time=function(params){KJUR.asn1.x509.Time.superclass.constructor.call(this);var type=null,timeParams=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERUTCTime=_KJUR_asn1.DERUTCTime,_DERGeneralizedTime=_KJUR_asn1.DERGeneralizedTime;this.setTimeParams=function(timeParams){this.timeParams=timeParams};this.getEncodedHex=function(){var o=null;if(this.timeParams!=null){if(this.type=="utc"){o=new _DERUTCTime(this.timeParams)}else{o=new _DERGeneralizedTime(this.timeParams)}}else{if(this.type=="utc"){o=new _DERUTCTime}else{o=new _DERGeneralizedTime}}this.TLV=o.getEncodedHex();return this.TLV};this.type="utc";if(params!==undefined){if(params.type!==undefined){this.type=params.type}else{if(params.str!==undefined){if(params.str.match(/^[0-9]{12}Z$/))this.type="utc";if(params.str.match(/^[0-9]{14}Z$/))this.type="gen"}}this.timeParams=params}};YAHOO.lang.extend(KJUR.asn1.x509.Time,KJUR.asn1.ASN1Object);KJUR.asn1.x509.AlgorithmIdentifier=function(params){KJUR.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this);this.nameAlg=null;this.asn1Alg=null;this.asn1Params=null;this.paramEmpty=false;var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.getEncodedHex=function(){if(this.nameAlg===null&&this.asn1Alg===null){throw"algorithm not specified"}if(this.nameAlg!==null&&this.asn1Alg===null){this.asn1Alg=_KJUR_asn1.x509.OID.name2obj(this.nameAlg)}var a=[this.asn1Alg];if(this.asn1Params!==null)a.push(this.asn1Params);var o=new _KJUR_asn1.DERSequence({array:a});this.hTLV=o.getEncodedHex();return this.hTLV};if(params!==undefined){if(params.name!==undefined){this.nameAlg=params.name}if(params.asn1params!==undefined){this.asn1Params=params.asn1params}if(params.paramempty!==undefined){this.paramEmpty=params.paramempty}}if(this.asn1Params===null&&this.paramEmpty===false&&this.nameAlg!==null){var lcNameAlg=this.nameAlg.toLowerCase();if(lcNameAlg.substr(-7,7)!=="withdsa"&&lcNameAlg.substr(-9,9)!=="withecdsa"){this.asn1Params=new _KJUR_asn1.DERNull}}};YAHOO.lang.extend(KJUR.asn1.x509.AlgorithmIdentifier,KJUR.asn1.ASN1Object);KJUR.asn1.x509.GeneralName=function(params){KJUR.asn1.x509.GeneralName.superclass.constructor.call(this);var asn1Obj=null,type=null,pTag={rfc822:"81",dns:"82",dn:"a4",uri:"86",ip:"87"},_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_DEROctetString=_KJUR_asn1.DEROctetString,_DERIA5String=_KJUR_asn1.DERIA5String,_DERTaggedObject=_KJUR_asn1.DERTaggedObject,_ASN1Object=_KJUR_asn1.ASN1Object,_X500Name=_KJUR_asn1.x509.X500Name,_pemtohex=pemtohex;this.explicit=false;this.setByParam=function(params){var str=null;var v=null;if(params===undefined)return;if(params.rfc822!==undefined){this.type="rfc822";v=new _DERIA5String({str:params[this.type]})}if(params.dns!==undefined){this.type="dns";v=new _DERIA5String({str:params[this.type]})}if(params.uri!==undefined){this.type="uri";v=new _DERIA5String({str:params[this.type]})}if(params.dn!==undefined){this.type="dn";this.explicit=true;v=new _X500Name({str:params.dn})}if(params.ldapdn!==undefined){this.type="dn";this.explicit=true;v=new _X500Name({ldapstr:params.ldapdn})}if(params.certissuer!==undefined){this.type="dn";this.explicit=true;var certStr=params.certissuer;var certHex=null;if(certStr.match(/^[0-9A-Fa-f]+$/)){certHex==certStr}if(certStr.indexOf("-----BEGIN ")!=-1){certHex=_pemtohex(certStr)}if(certHex==null)throw"certissuer param not cert";var x=new X509;x.hex=certHex;var dnHex=x.getIssuerHex();v=new _ASN1Object;v.hTLV=dnHex}if(params.certsubj!==undefined){this.type="dn";this.explicit=true;var certStr=params.certsubj;var certHex=null;if(certStr.match(/^[0-9A-Fa-f]+$/)){certHex==certStr}if(certStr.indexOf("-----BEGIN ")!=-1){certHex=_pemtohex(certStr)}if(certHex==null)throw"certsubj param not cert";var x=new X509;x.hex=certHex;var dnHex=x.getSubjectHex();v=new _ASN1Object;v.hTLV=dnHex}if(params.ip!==undefined){this.type="ip";this.explicit=false;var ip=params.ip;var hIP;var malformedIPMsg="malformed IP address";if(ip.match(/^[0-9.]+[.][0-9.]+$/)){hIP=intarystrtohex("["+ip.split(".").join(",")+"]");if(hIP.length!==8)throw malformedIPMsg}else if(ip.match(/^[0-9A-Fa-f:]+:[0-9A-Fa-f:]+$/)){hIP=ipv6tohex(ip)}else if(ip.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/)){hIP=ip}else{throw malformedIPMsg}v=new _DEROctetString({hex:hIP})}if(this.type==null)throw"unsupported type in params="+params;this.asn1Obj=new _DERTaggedObject({explicit:this.explicit,tag:pTag[this.type],obj:v})};this.getEncodedHex=function(){return this.asn1Obj.getEncodedHex()};if(params!==undefined){this.setByParam(params)}};YAHOO.lang.extend(KJUR.asn1.x509.GeneralName,KJUR.asn1.ASN1Object);KJUR.asn1.x509.GeneralNames=function(paramsArray){KJUR.asn1.x509.GeneralNames.superclass.constructor.call(this);var asn1Array=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.setByParamArray=function(paramsArray){for(var i=0;i<paramsArray.length;i++){var o=new _KJUR_asn1.x509.GeneralName(paramsArray[i]);this.asn1Array.push(o)}};this.getEncodedHex=function(){var o=new _KJUR_asn1.DERSequence({array:this.asn1Array});return o.getEncodedHex()};this.asn1Array=new Array;if(typeof paramsArray!="undefined"){this.setByParamArray(paramsArray)}};YAHOO.lang.extend(KJUR.asn1.x509.GeneralNames,KJUR.asn1.ASN1Object);KJUR.asn1.x509.DistributionPointName=function(gnOrRdn){KJUR.asn1.x509.DistributionPointName.superclass.constructor.call(this);var asn1Obj=null,type=null,tag=null,asn1V=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERTaggedObject=_KJUR_asn1.DERTaggedObject;this.getEncodedHex=function(){if(this.type!="full")throw"currently type shall be 'full': "+this.type;this.asn1Obj=new _DERTaggedObject({explicit:false,tag:this.tag,obj:this.asn1V});this.hTLV=this.asn1Obj.getEncodedHex();return this.hTLV};if(gnOrRdn!==undefined){if(_KJUR_asn1.x509.GeneralNames.prototype.isPrototypeOf(gnOrRdn)){this.type="full";this.tag="a0";this.asn1V=gnOrRdn}else{throw"This class supports GeneralNames only as argument"}}};YAHOO.lang.extend(KJUR.asn1.x509.DistributionPointName,KJUR.asn1.ASN1Object);KJUR.asn1.x509.DistributionPoint=function(params){KJUR.asn1.x509.DistributionPoint.superclass.constructor.call(this);var asn1DP=null,_KJUR=KJUR,_KJUR_asn1=_KJUR.asn1;this.getEncodedHex=function(){var seq=new _KJUR_asn1.DERSequence;if(this.asn1DP!=null){var o1=new _KJUR_asn1.DERTaggedObject({explicit:true,tag:"a0",obj:this.asn1DP});seq.appendASN1Object(o1)}this.hTLV=seq.getEncodedHex();return this.hTLV};if(params!==undefined){if(params.dpobj!==undefined){this.asn1DP=params.dpobj}}};YAHOO.lang.extend(KJUR.asn1.x509.DistributionPoint,KJUR.asn1.ASN1Object);KJUR.asn1.x509.OID=new function(params){this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"};this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",ecPublicKey:"1.2.840.10045.2.1",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",extensionRequest:"1.2.840.113549.1.9.14"};this.objCache={};this.name2obj=function(name){if(typeof this.objCache[name]!="undefined")return this.objCache[name];if(typeof this.name2oidList[name]=="undefined")throw"Name of ObjectIdentifier not defined: "+name;var oid=this.name2oidList[name];var obj=new KJUR.asn1.DERObjectIdentifier({oid:oid});this.objCache[name]=obj;return obj};this.atype2obj=function(atype){if(typeof this.objCache[atype]!="undefined")return this.objCache[atype];if(typeof this.atype2oidList[atype]=="undefined")throw"AttributeType name undefined: "+atype;var oid=this.atype2oidList[atype];var obj=new KJUR.asn1.DERObjectIdentifier({oid:oid});this.objCache[atype]=obj;return obj}};KJUR.asn1.x509.OID.oid2name=function(oid){var list=KJUR.asn1.x509.OID.name2oidList;for(var name in list){if(list[name]==oid)return name}return""};KJUR.asn1.x509.OID.oid2atype=function(oid){var list=KJUR.asn1.x509.OID.atype2oidList;for(var atype in list){if(list[atype]==oid)return atype}return oid};KJUR.asn1.x509.OID.name2oid=function(name){var list=KJUR.asn1.x509.OID.name2oidList;if(list[name]===undefined)return"";return list[name]};KJUR.asn1.x509.X509Util={};KJUR.asn1.x509.X509Util.newCertPEM=function(param){var _KJUR_asn1_x509=KJUR.asn1.x509,_TBSCertificate=_KJUR_asn1_x509.TBSCertificate,_Certificate=_KJUR_asn1_x509.Certificate;var o=new _TBSCertificate;if(param.serial!==undefined)o.setSerialNumberByParam(param.serial);else throw"serial number undefined.";if(typeof param.sigalg.name==="string")o.setSignatureAlgByParam(param.sigalg);else throw"unproper signature algorithm name";if(param.issuer!==undefined)o.setIssuerByParam(param.issuer);else throw"issuer name undefined.";if(param.notbefore!==undefined)o.setNotBeforeByParam(param.notbefore);else throw"notbefore undefined.";if(param.notafter!==undefined)o.setNotAfterByParam(param.notafter);else throw"notafter undefined.";if(param.subject!==undefined)o.setSubjectByParam(param.subject);else throw"subject name undefined.";if(param.sbjpubkey!==undefined)o.setSubjectPublicKeyByGetKey(param.sbjpubkey);else throw"subject public key undefined.";if(param.ext!==undefined&&param.ext.length!==undefined){for(var i=0;i<param.ext.length;i++){for(key in param.ext[i]){o.appendExtensionByName(key,param.ext[i][key])}}}if(param.cakey===undefined&&param.sighex===undefined)throw"param cakey and sighex undefined.";var caKey=null;var cert=null;if(param.cakey){if(param.cakey.isPrivate===true){caKey=param.cakey}else{caKey=KEYUTIL.getKey.apply(null,param.cakey)}cert=new _Certificate({tbscertobj:o,prvkeyobj:caKey});cert.sign()}if(param.sighex){cert=new _Certificate({tbscertobj:o});cert.setSignatureHex(param.sighex)}return cert.getPEMString()};