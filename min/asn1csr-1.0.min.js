if(typeof KJUR.asn1.csr=="undefined"||!KJUR.asn1.csr)KJUR.asn1.csr={};KJUR.asn1.csr.CertificationRequest=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERBitString=_KJUR_asn1.DERBitString,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_csr=_KJUR_asn1.csr,_KJUR_asn1_x509=_KJUR_asn1.x509;_KJUR_asn1_csr.CertificationRequest.superclass.constructor.call(this);var asn1CSRInfo=null;var asn1SignatureAlg=null;var asn1Sig=null;var hexSig=null;var prvKey=null;this.sign=function(sigAlgName,prvKeyObj){if(this.prvKey==null)this.prvKey=prvKeyObj;this.asn1SignatureAlg=new _KJUR_asn1_x509.AlgorithmIdentifier({name:sigAlgName});sig=new _KJUR.crypto.Signature({alg:sigAlgName});sig.init(this.prvKey);sig.updateHex(this.asn1CSRInfo.getEncodedHex());this.hexSig=sig.sign();this.asn1Sig=new _DERBitString({hex:"00"+this.hexSig});var seq=new _DERSequence({array:[this.asn1CSRInfo,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.getPEMString=function(){return hextopem(this.getEncodedHex(),"CERTIFICATE REQUEST")};this.getEncodedHex=function(){if(this.isModified==false&&this.hTLV!=null)return this.hTLV;throw"not signed yet"};if(params!==undefined&&params.csrinfo!==undefined){this.asn1CSRInfo=params.csrinfo}};YAHOO.lang.extend(KJUR.asn1.csr.CertificationRequest,KJUR.asn1.ASN1Object);KJUR.asn1.csr.CertificationRequestInfo=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERInteger=_KJUR_asn1.DERInteger,_DERSequence=_KJUR_asn1.DERSequence,_DERSet=_KJUR_asn1.DERSet,_DERNull=_KJUR_asn1.DERNull,_DERTaggedObject=_KJUR_asn1.DERTaggedObject,_DERObjectIdentifier=_KJUR_asn1.DERObjectIdentifier,_KJUR_asn1_csr=_KJUR_asn1.csr,_KJUR_asn1_x509=_KJUR_asn1.x509,_X500Name=_KJUR_asn1_x509.X500Name,_Extension=_KJUR_asn1_x509.Extension,_KEYUTIL=KEYUTIL;_KJUR_asn1_csr.CertificationRequestInfo.superclass.constructor.call(this);this._initialize=function(){this.asn1Array=new Array;this.asn1Version=new _DERInteger({int:0});this.asn1Subject=null;this.asn1SubjPKey=null;this.extensionsArray=new Array};this.setSubjectByParam=function(x500NameParam){this.asn1Subject=new _X500Name(x500NameParam)};this.setSubjectPublicKeyByGetKey=function(keyParam){var keyObj=_KEYUTIL.getKey(keyParam);this.asn1SubjPKey=new _KJUR_asn1_x509.SubjectPublicKeyInfo(keyObj)};this.appendExtensionByName=function(name,extParams){_Extension.appendByNameToArray(name,extParams,this.extensionsArray)};this.getEncodedHex=function(){this.asn1Array=new Array;this.asn1Array.push(this.asn1Version);this.asn1Array.push(this.asn1Subject);this.asn1Array.push(this.asn1SubjPKey);if(this.extensionsArray.length>0){var extSeq=new _DERSequence({array:this.extensionsArray});var extSet=new _DERSet({array:[extSeq]});var extSeq2=new _DERSequence({array:[new _DERObjectIdentifier({oid:"1.2.840.113549.1.9.14"}),extSet]});var extTagObj=new _DERTaggedObject({explicit:true,tag:"a0",obj:extSeq2});this.asn1Array.push(extTagObj)}else{var extTagObj=new _DERTaggedObject({explicit:false,tag:"a0",obj:new _DERNull});this.asn1Array.push(extTagObj)}var o=new _DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();this.isModified=false;return this.hTLV};this._initialize()};YAHOO.lang.extend(KJUR.asn1.csr.CertificationRequestInfo,KJUR.asn1.ASN1Object);KJUR.asn1.csr.CSRUtil=new function(){};KJUR.asn1.csr.CSRUtil.newCSRPEM=function(param){var _KEYUTIL=KEYUTIL,_KJUR_asn1_csr=KJUR.asn1.csr;if(param.subject===undefined)throw"parameter subject undefined";if(param.sbjpubkey===undefined)throw"parameter sbjpubkey undefined";if(param.sigalg===undefined)throw"parameter sigalg undefined";if(param.sbjprvkey===undefined)throw"parameter sbjpubkey undefined";var csri=new _KJUR_asn1_csr.CertificationRequestInfo;csri.setSubjectByParam(param.subject);csri.setSubjectPublicKeyByGetKey(param.sbjpubkey);if(param.ext!==undefined&&param.ext.length!==undefined){for(var i=0;i<param.ext.length;i++){for(key in param.ext[i]){csri.appendExtensionByName(key,param.ext[i][key])}}}var csr=new _KJUR_asn1_csr.CertificationRequest({csrinfo:csri});var prvKey=_KEYUTIL.getKey(param.sbjprvkey);csr.sign(param.sigalg,prvKey);var pem=csr.getPEMString();return pem};KJUR.asn1.csr.CSRUtil.getInfo=function(sPEM){var _ASN1HEX=ASN1HEX;var _getTLVbyList=_ASN1HEX.getTLVbyList;var result={};result.subject={};result.pubkey={};if(sPEM.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw"argument is not PEM file";var hex=pemtohex(sPEM,"CERTIFICATE REQUEST");result.subject.hex=_getTLVbyList(hex,0,[0,1]);result.subject.name=X509.hex2dn(result.subject.hex);result.pubkey.hex=_getTLVbyList(hex,0,[0,2]);result.pubkey.obj=KEYUTIL.getKey(result.pubkey.hex,null,"pkcs8pub");return result};