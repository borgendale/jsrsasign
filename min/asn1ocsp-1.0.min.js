if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.ocsp=="undefined"||!KJUR.asn1.ocsp)KJUR.asn1.ocsp={};KJUR.asn1.ocsp.DEFAULT_HASH="sha1";KJUR.asn1.ocsp.CertID=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DEROctetString=_KJUR_asn1.DEROctetString,_DERInteger=_KJUR_asn1.DERInteger,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_x509=_KJUR_asn1.x509,_AlgorithmIdentifier=_KJUR_asn1_x509.AlgorithmIdentifier,_KJUR_asn1_ocsp=_KJUR_asn1.ocsp,_DEFAULT_HASH=_KJUR_asn1_ocsp.DEFAULT_HASH,_KJUR_crypto=_KJUR.crypto,_hashHex=_KJUR_crypto.Util.hashHex,_X509=X509,_ASN1HEX=ASN1HEX;_KJUR_asn1_ocsp.CertID.superclass.constructor.call(this);this.dHashAlg=null;this.dIssuerNameHash=null;this.dIssuerKeyHash=null;this.dSerialNumber=null;this.setByValue=function(issuerNameHashHex,issuerKeyHashHex,serialNumberHex,algName){if(algName===undefined)algName=_DEFAULT_HASH;this.dHashAlg=new _AlgorithmIdentifier({name:algName});this.dIssuerNameHash=new _DEROctetString({hex:issuerNameHashHex});this.dIssuerKeyHash=new _DEROctetString({hex:issuerKeyHashHex});this.dSerialNumber=new _DERInteger({hex:serialNumberHex})};this.setByCert=function(issuerCert,subjectCert,algName){if(algName===undefined)algName=_DEFAULT_HASH;var xSbj=new _X509;xSbj.readCertPEM(subjectCert);var xIss=new _X509;xIss.readCertPEM(issuerCert);var hISS_SPKI=xIss.getPublicKeyHex();var issuerKeyHex=_ASN1HEX.getTLVbyList(hISS_SPKI,0,[1,0],"30");var serialNumberHex=xSbj.getSerialNumberHex();var issuerNameHashHex=_hashHex(xIss.getSubjectHex(),algName);var issuerKeyHashHex=_hashHex(issuerKeyHex,algName);this.setByValue(issuerNameHashHex,issuerKeyHashHex,serialNumberHex,algName);this.hoge=xSbj.getSerialNumberHex()};this.getEncodedHex=function(){if(this.dHashAlg===null&&this.dIssuerNameHash===null&&this.dIssuerKeyHash===null&&this.dSerialNumber===null)throw"not yet set values";var a=[this.dHashAlg,this.dIssuerNameHash,this.dIssuerKeyHash,this.dSerialNumber];var seq=new _DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(params!==undefined){var p=params;if(p.issuerCert!==undefined&&p.subjectCert!==undefined){var alg=_DEFAULT_HASH;if(p.alg===undefined)alg=undefined;this.setByCert(p.issuerCert,p.subjectCert,alg)}else if(p.namehash!==undefined&&p.keyhash!==undefined&&p.serial!==undefined){var alg=_DEFAULT_HASH;if(p.alg===undefined)alg=undefined;this.setByValue(p.namehash,p.keyhash,p.serial,alg)}else{throw"invalid constructor arguments"}}};YAHOO.lang.extend(KJUR.asn1.ocsp.CertID,KJUR.asn1.ASN1Object);KJUR.asn1.ocsp.Request=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_ocsp=_KJUR_asn1.ocsp;_KJUR_asn1_ocsp.Request.superclass.constructor.call(this);this.dReqCert=null;this.dExt=null;this.getEncodedHex=function(){var a=[];if(this.dReqCert===null)throw"reqCert not set";a.push(this.dReqCert);var seq=new _DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!=="undefined"){var o=new _KJUR_asn1_ocsp.CertID(params);this.dReqCert=o}};YAHOO.lang.extend(KJUR.asn1.ocsp.Request,KJUR.asn1.ASN1Object);KJUR.asn1.ocsp.TBSRequest=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_ocsp=_KJUR_asn1.ocsp;_KJUR_asn1_ocsp.TBSRequest.superclass.constructor.call(this);this.version=0;this.dRequestorName=null;this.dRequestList=[];this.dRequestExt=null;this.setRequestListByParam=function(aParams){var a=[];for(var i=0;i<aParams.length;i++){var dReq=new _KJUR_asn1_ocsp.Request(aParams[0]);a.push(dReq)}this.dRequestList=a};this.getEncodedHex=function(){var a=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var seqRequestList=new _DERSequence({array:this.dRequestList});a.push(seqRequestList);if(this.dRequestExt!==null)throw"requestExtensions not supported";var seq=new _DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(params!==undefined){if(params.reqList!==undefined)this.setRequestListByParam(params.reqList)}};YAHOO.lang.extend(KJUR.asn1.ocsp.TBSRequest,KJUR.asn1.ASN1Object);KJUR.asn1.ocsp.OCSPRequest=function(params){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_DERSequence=_KJUR_asn1.DERSequence,_KJUR_asn1_ocsp=_KJUR_asn1.ocsp;_KJUR_asn1_ocsp.OCSPRequest.superclass.constructor.call(this);this.dTbsRequest=null;this.dOptionalSignature=null;this.getEncodedHex=function(){var a=[];if(this.dTbsRequest!==null){a.push(this.dTbsRequest)}else{throw"tbsRequest not set"}if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var seq=new _DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(params!==undefined){if(params.reqList!==undefined){var o=new _KJUR_asn1_ocsp.TBSRequest(params);this.dTbsRequest=o}}};YAHOO.lang.extend(KJUR.asn1.ocsp.OCSPRequest,KJUR.asn1.ASN1Object);KJUR.asn1.ocsp.OCSPUtil={};KJUR.asn1.ocsp.OCSPUtil.getRequestHex=function(issuerCert,subjectCert,alg){var _KJUR=KJUR,_KJUR_asn1=_KJUR.asn1,_KJUR_asn1_ocsp=_KJUR_asn1.ocsp;if(alg===undefined)alg=_KJUR_asn1_ocsp.DEFAULT_HASH;var param={alg:alg,issuerCert:issuerCert,subjectCert:subjectCert};var o=new _KJUR_asn1_ocsp.OCSPRequest({reqList:[param]});return o.getEncodedHex()};KJUR.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(h){var _ASN1HEX=ASN1HEX;var _getVbyList=_ASN1HEX.getVbyList;var _getIdxbyList=_ASN1HEX.getIdxbyList;var _getVbyList=_ASN1HEX.getVbyList;var _getV=_ASN1HEX.getV;var result={};try{var v=_getVbyList(h,0,[0],"0a");result.responseStatus=parseInt(v,16)}catch(ex){}if(result.responseStatus!==0)return result;try{var idxCertStatus=_getIdxbyList(h,0,[1,0,1,0,0,2,0,1]);if(h.substr(idxCertStatus,2)==="80"){result.certStatus="good"}else if(h.substr(idxCertStatus,2)==="a1"){result.certStatus="revoked";result.revocationTime=hextoutf8(_getVbyList(h,idxCertStatus,[0]))}else if(h.substr(idxCertStatus,2)==="82"){result.certStatus="unknown"}}catch(ex){}try{var idxThisUpdate=_getIdxbyList(h,0,[1,0,1,0,0,2,0,2]);result.thisUpdate=hextoutf8(_getV(h,idxThisUpdate))}catch(ex){}try{var idxEncapNextUpdate=_getIdxbyList(h,0,[1,0,1,0,0,2,0,3]);if(h.substr(idxEncapNextUpdate,2)==="a0"){result.nextUpdate=hextoutf8(_getVbyList(h,idxEncapNextUpdate,[0]))}}catch(ex){}return result};